// jQuery.scrollablePagination version 0.1
(function(){var e;e=function(){function e(e,t){this.container=e,t==null&&(t={}),this.initialize(t)}return e.prototype.initialize=function(e){return e==null&&(e={}),this.page=e.start_page||1,this.fetch_url=e.fetch_url||this.container.data("fetch-url"),this.scrollable_container=function(){switch(!1){case e.scrollable_container!==null:return this.container;case!e.scrollable_container:return $(e.scrollable_container);default:return $(window)}}.call(this),this.afterLoaded=e.afterLoaded,this.scroll_offset=200,this.done=!1,this.last_scroll_handling_call=+(new Date),this.loading=!1,this.bindAll()},e.prototype.bindAll=function(){var e=this;return this.scrollable_container.on("scroll",function(){return e.handleScroll()})},e.prototype.handleScroll=function(){var e,t,n;if(this.done)return;t=+(new Date);if(t-this.last_scroll_handling_call<200||this.done)return this.resetScrollTimer(t);this.last_scroll_handling_call=t,n=this.scrollable_container.scrollTop(),e=this.loadThreshold();if(n>e&&!this.loading)return this.loadNextDataSet()},e.prototype.resetScrollTimer=function(e){var t=this;return this.scroll_timer&&clearTimeout(this.scroll_timer),this.scroll_timer=setTimeout(function(){return t.handleScroll()},200)},e.prototype.loadThreshold=function(){return this.container.innerHeight()+this.container.offset().top-(this.scrollable_container.innerHeight()+this.scroll_offset)},e.prototype.loadNextDataSet=function(){var e=this;return this.setLoading(!0),$.get(this.pageUrl(++this.page),function(t){return e.nextPageLoaded(t)},"html")},e.prototype.nextPageLoaded=function(e){var t;this.setLoading(!1);if(!e)return this.done=!0;t=$(e).appendTo(this.container);if($.isFunction(this.afterLoaded))return this.afterLoaded(t)},e.prototype.setLoading=function(e){return this.loading=e,this.loading?this.container.addClass("loading").append($("<div/>").addClass("scrollable-pagination-loader").text("Loading content ...")):this.container.removeClass("loading").find(".scrollable-pagination-loader").remove()},e.prototype.pageUrl=function(e){var t;return this.fetch_url.match(/:page/)?this.fetch_url.replace(/:page/,e):(t=this.fetch_url,t+=t.match(/\?/)?"&":"?",t+="page="+e)},e.prototype.reset=function(e){return e==null&&(e={}),this.initialize(e)},e}(),function(t){return t.fn.scrollablePagination=function(n){var r,i;return r=t(this),i=r.data("scrollable-pagination"),i?i:r.data("scrollable-pagination",new e(r,n))}}(jQuery)}).call(this);